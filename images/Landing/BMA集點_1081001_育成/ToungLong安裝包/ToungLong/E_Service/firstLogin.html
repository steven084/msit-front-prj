<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <meta content="" name="description">
    <meta content="" name="author">
    <title>
        系統首次登入查詢
    </title>
    <!-- Custom fonts for this template -->
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link href="vendor/font/Nunito.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="vendor/custom/css/sb-admin-2.css" rel="stylesheet">
    <link href="vendor/custom/css/loader.css" rel="stylesheet">
    <link href="vendor/custom/css/custom.css" rel="stylesheet">
    <style type="text/css">
    .code {
        background: url(code_bg.jpg);
        font-family: Arial;
        font-style: italic;
        color: blue;
        font-size: 30px;
        border: 0;
        padding: 2px 3px;
        letter-spacing: 3px;
        font-weight: bolder;
        float: left;
        cursor: pointer;
        width: 150px;
        height: 60px;
        line-height: 60px;
        text-align: center;
        vertical-align: middle;

    }

    a {
        text-decoration: none;
        font-size: 12px;
        color: #288bc4;
    }

    a:hover {
        text-decoration: underline;
    }
    </style>
    </link>
    </link>
    </link>
    </link>
    </link>
    </meta>
    </meta>
    </meta>
    </meta>
    </meta>
</head>

<body class="bg-gradient-primary">
    <div class="container">
        <!-- Outer Row -->
        <div class="row justify-content-center">
            <div class="col-xl-10 col-lg-12 col-md-9">
                <div class="card o-hidden border-0 shadow-lg my-5">
                    <div class="card-body p-0">
                        <!-- Nested Row within Card Body -->
                        <div class="row">
                            <div class="col-lg-6 d-none d-lg-block bg-login-image">
                            </div>
                            <div class="col-lg-6">
                                <div class="p-5">
                                    <div class="text-center">
                                        <h1 class="h4 text-gray-900 mb-4">
                                            系統首次登入查詢
                                        </h1>
                                    </div>
                                    <!-- <form method="post" onsubmit="return login_submit()"> -->
                                    <form method="post" onsubmit="validateCode(); return false;">
                                        <div class="form-group">
                                            <input autofocus="autofocus" class="form-control form-control-user" name="input" placeholder="請輸入住戶姓名" required="required" type="text">
                                            </input>
                                        </div>
                                        <div class="form-group">
                                            <input autofocus="autofocus" class="form-control form-control-user" name="input" placeholder="請輸入住址" required="required" type="text">
                                            </input>
                                        </div>
                                        <label for="">
                                            <span style="color:red">
                                                *
                                            </span>
                                            住址範例：XX市XX區XX街XX巷XX號X樓之X
                                        </label>
                                        <div>
                                            <div class="form-group">
                                                <input class="form-control form-control-user" id="inputCode" placeholder="請輸入驗證碼" required="required" type="text">
                                                </input>
                                            </div>
                                            <table border="0" cellpadding="5" cellspacing="5">
                                                <tr>
                                                    <td>
                                                    </td>
                                                    <td>
                                                        <div class="code" id="checkCode" onclick="createCode()">
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <a href="#" onclick="createCode()">
                                                            更換驗證碼
                                                        </a>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                        <div class="form-group">
                                            <div class="custom-control custom-checkbox small" id="alertMessage">
                                            </div>
                                        </div>
                                        <div class="form-group row">
                                            <div class="col-md-12">
                                                <input class="btn btn-primary btn-user btn-block" name="submit" onclick="validateCode();" type="submit" value="首次查詢">
                                                </input>
                                            </div>
                                        </div>
                                    </form>
                                    <br />
                                    <br />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- loading Modal -->
    <div id="loader" style="display:none">
        <div class="loader">
            <div class="hexagon-container">
                <div class="hexagon hex_1">
                </div>
                <div class="hexagon hex_2">
                </div>
                <div class="hexagon hex_3">
                </div>
                <div class="hexagon hex_4">
                </div>
                <div class="hexagon hex_5">
                </div>
                <div class="hexagon hex_6">
                </div>
                <div class="hexagon hex_7">
                </div>
            </div>
        </div>
        <div class="loader-mask">
        </div>
    </div>
    <!-- Bootstrap core JavaScript-->
    <script src="vendor/jquery/jquery.min.js">
    </script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js">
    </script>
    <!-- Custom scripts for all pages-->
    <script src="vendor/custom/js/sb-admin-2.min.js">
    </script>
    <script language="javascript" type="text/javascript">
    createCode();
    var code;

    function createCode() {
        code = "";
        var codeLength = 4;
        var checkCode = document.getElementById("checkCode");
        // var codeChars = new Array(0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
        //     'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z',
        //     'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z');
        var codeChars = new Array(0, 1, 2, 3, 4, 5, 6, 7, 8, 9);
        for (var i = 0; i < codeLength; i++) {
            // var charNum = Math.floor(Math.random() * 52);
            var charNum = Math.floor(Math.random() * 10);
            code += codeChars[charNum];
        }
        if (checkCode) {
            checkCode.className = "code";
            checkCode.innerHTML = code;
        }
    }

    function validateCode() {
        var inputCode = document.getElementById("inputCode").value;
        if (inputCode.length <= 0) {
            alertMessage("請輸入驗證碼!!", "red");
        } else if (inputCode.toUpperCase() != code.toUpperCase()) {
            alertMessage("驗證碼輸入錯誤!!", "red");
            createCode();
        } else {
            // alert("验证码正确！");
            login_submit();
        }
    }
    </script>
    <script type="text/javascript">
    function alertMessage(msg, color) {
        document.getElementById('alertMessage').innerHTML = "<span style='color:" + color + "'>*" + msg + "</span>";
    }

    function login_submit() {
        var input1 = document.getElementsByName('input')[0].value;
        var input2 = document.getElementsByName('input')[1].value;

        $.ajax({
            type: "POST",
            url: "pages/firstLogin/firstLogin.php",
            data: {
                input1: input1,
                input2: input2
            },
            cache: false,
            beforeSend: function() {
                document.getElementById("loader").style.display = "flex";
            },
            complete: function() {
                document.getElementById("loader").style.display = "none";
            }
        }).done(function(msg) {
            if (msg == "1") {
                alertMessage("查無此使用者!!", "red");
                createCode();
            } else if (msg == "2") {
                alertMessage("此帳戶已經使用!!", "red");
                createCode();
            } else {
                alertMessage(msg, "blue");
                createCode();
            }
        });
        return false;
    }
    </script>
</body>

</html>